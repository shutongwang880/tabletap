<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TableTap - Register</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" href="https://via.placeholder.com/32" type="image/png">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }

        h1, h2, h3, h4, .brand-font {
            font-family: 'Playfair Display', serif;
            letter-spacing: 0.05em;
        }

        :root {
            --primary-color: #FF6B6B;  
            --secondary-color: #4ECDC4;  
            --dark-color: #292F36;  
            --light-color: #F7FFF7;   
            --accent-color: #FFE66D; 
        }

        .menu-bar {
            background-color: var(--dark-color);
        }

        .menu-bar .btn:hover {
            background-color: var(--primary-color);
        }

        .menu-bar .btn.active {
            background-color: var(--accent-color);
            color: var(--dark-color);
        }

        /* Content area styles */
        #main-content {
            background-color: white;
            color: black;
            min-height: 100vh;
            padding: 20px 40px; 
        }

        /* Menu bar styles */
        .menu-bar {
            background-color: #333;
            min-height: 100vh;
            color: #fff;
        }

        .menu-bar .btn:hover {
            background-color: #FFB300;
            transform: scale(1.05);
        }

        .menu-bar .btn {
            width: 100%;
            margin: 10px 0;
            border-radius: 0.375rem;
            background-color: #333;
            color: #fff;
            border: none;
        }

        .menu-bar .btn.active {
            background-color: #FFC107;
        }

        .btn {
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .btn:active {
            transform: translateY(0);
        }

        html, body {
            height: 100%;
        }

        body {
            display: flex;
            flex-direction: column;
        }

        .container-fluid {
            flex: 1;
        }

        footer {
            background-color: var(--dark-color);
            color: white;
            padding: 20px 0;
            width: 100%;
        }

        @media (max-width: 768px) {
            #main-content {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Alert Container for JavaScript-triggered notifications -->
    <div id="alertContainer" class="position-fixed top-0 end-0 p-3" style="z-index: 1050"></div>

    <!-- Django Messages -->
    {% if messages %}
    <div class="message-container">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-float alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="container-fluid">
        <div class="row">
            <!-- Left menu bar -->
            <div class="col-md-3 col-lg-2 menu-bar p-3">
                <h4 class="text-center mb-4">
                    <a href="{% url 'index' %}" class="text-decoration-none text-white">TableTap</a>
                </h4>
                <a href="{% url 'login' %}" class="btn active" id="loginBtn">Login</a>
                <a href="{% url 'editmenu' %}" class="btn" id="editMenuBtn">Edit Menu</a>
                <a href="{% url 'order' %}" class="btn" id="viewOrdersBtn">View Orders</a>
                <a href="{% url 'qrcode' %}" class="btn" id="generateQRCodeBtn">Generate QR Code</a>
            </div>
    
            <!-- Main content area -->

                    <div id="main-content" class="col-md-9 col-lg-10">
                        <div class="row justify-content-center">
                            <div class="col-md-8 col-lg-6">
                                <h2 class="mb-4">Create an Account</h2>

                            <form id="registerForm" method="post" action="{% url 'register' %}">
                                {% csrf_token %}
                                <div class="mb-3 position-relative">
                                    <label for="username" class="form-label">Username</label>
                                    <input type="text" class="form-control" id="username" name="username" required>
                                    <div class="invalid-feedback">Please enter a username.</div>
                                </div>
                                <div class="mb-3 position-relative">
                                    <label for="email" class="form-label">Email address</label>
                                    <input type="email" class="form-control" id="email" name="email" required>
                                    <div class="invalid-feedback">Please enter a valid email address.</div>
                                </div>
                                <div class="mb-3 position-relative">
                                    <label for="regPassword1" class="form-label">Password</label>
                                    <div class="input-group">
                                        <input type="password" class="form-control" id="regPassword1" name="password1" required>
                                        <span class="input-group-text password-toggle" onclick="togglePasswordVisibility('regPassword1', 'toggleIcon1')">
                                            <i class="fa fa-eye" id="toggleIcon1"></i>
                                        </span>
                                    </div>
                                <div class="mb-3 position-relative">
                                    <label for="regPassword2" class="form-label">Confirm Password</label>
                                    <div class="input-group">
                                        <input type="password" class="form-control" id="regPassword2" name="password2" required>
                                        <span class="input-group-text password-toggle" onclick="togglePasswordVisibility('regPassword2', 'toggleIcon2')">
                                            <i class="fa fa-eye" id="toggleIcon2"></i>
                                        </span>
                                    </div>
                                    <div class="invalid-feedback">Passwords do not match.</div>
                                </div>
                                <div class="d-grid gap-2">
                                    <button type="submit" class="btn btn-primary">Register</button>
                                    <a href="{% url 'login' %}" class="btn btn-outline-primary" id="loginBtn">Already have an account? Login</a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    <footer class="bg-dark text-light py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <p>&copy; 2025 TableTap. All rights reserved.</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <a href="#" class="text-light me-3">Privacy Policy</a>
                    <a href="#" class="text-light">Terms of Service</a>
                </div>
            </div>
        </div>
    </footer>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Toggle between login and registration forms
        document.getElementById('signupBtn').addEventListener('click', function() {
            document.getElementById('loginForm').classList.add('d-none');
            document.getElementById('registerForm').classList.remove('d-none');
        });
        
        document.getElementById('backToLoginBtn').addEventListener('click', function() {
            document.getElementById('registerForm').classList.add('d-none');
            document.getElementById('loginForm').classList.remove('d-none');
        });

        // Toggle password visibility
        function togglePasswordVisibility(inputId = 'password', iconId = 'toggleIcon') {
            const passwordInput = document.getElementById(inputId);
            const toggleIcon = document.getElementById(iconId);
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.classList.remove('fa-eye');
                toggleIcon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                toggleIcon.classList.remove('fa-eye-slash');
                toggleIcon.classList.add('fa-eye');
            }
        }

        // Check if passwords match
        document.getElementById('regPassword2').addEventListener('input', function() {
            const password1 = document.getElementById('regPassword1').value;
            const password2 = this.value;
            
            if (password2 && password1 !== password2) {
                this.setCustomValidity("Passwords do not match");
                this.classList.add('is-invalid');
            } else {
                this.setCustomValidity("");
                this.classList.remove('is-invalid');
            }
        });

        // Form validation and AJAX submission
        document.getElementById('loginForm').addEventListener('submit', function(event) {
            event.preventDefault();
            
            // Basic form validation
            const email = document.getElementById('email');
            const password = document.getElementById('password');
            
            let isValid = true;
            
            if (!email.value || !email.checkValidity()) {
                email.classList.add('is-invalid');
                isValid = false;
            } else {
                email.classList.remove('is-invalid');
            }
            
            if (!password.value) {
                password.classList.add('is-invalid');
                isValid = false;
            } else {
                password.classList.remove('is-invalid');
            }
            
            if (isValid) {
                const formData = new FormData(this);
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                
                fetch('{% url "login" %}', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'X-CSRFToken': csrfToken
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Server responded with status: ' + response.status);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        showAlert('success');
                        setTimeout(() => {
                            window.location.href = '{% url "index" %}';
                        }, 1500);
                    } else {
                        showAlert(data.message || 'Login failed. Please check your email and password', 'danger');
                        console.error('Login error:', data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showAlert('Error: ' + error.message, 'danger');
                });
            }
        });

        document.getElementById('registerForm').addEventListener('submit', function(event) {
        event.preventDefault();
        
        // Clear any previous error messages
        clearAlerts();

        // Basic form validation
        const email = document.getElementById('regEmail');
        const password1 = document.getElementById('regPassword1');
        const password2 = document.getElementById('regPassword2');
        
        let isValid = true;

        // Validate email
        if (!email.value || !email.checkValidity()) {
            email.classList.add('is-invalid');
            isValid = false;
            showAlert('Please enter a valid email address.', 'danger');
        } else {
            email.classList.remove('is-invalid');
        }
        
        // Validate password1
        if (!password1.value || password1.value.length < 8) {
            password1.classList.add('is-invalid');
            isValid = false;
            showAlert('Password must be at least 8 characters long.', 'danger');
        } else {
            password1.classList.remove('is-invalid');
        }
        
        // Validate password2
        if (!password2.value || password1.value !== password2.value) {
            password2.classList.add('is-invalid');
            isValid = false;
            showAlert('Passwords do not match.', 'danger');
        } else {
            password2.classList.remove('is-invalid');
        }

        if (isValid) {
            // AJAX submission if validation is successful
            const formData = new FormData(this);
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
            
            fetch('{% url "register" %}', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': csrfToken
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('Registration successful. Redirecting...', 'success');
                    setTimeout(() => {
                        window.location.href = '{% url "index" %}';
                    }, 1500);
                } else {
                    // Handle backend errors and show them
                    showAlert(data.message || 'Registration failed. Please try again.', 'danger');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showAlert('An error occurred. Please try again.', 'danger');
            });
        }
    });

    // Function to clear previous alerts
    function clearAlerts() {
        const alertContainer = document.getElementById('alertContainer');
        alertContainer.innerHTML = ''; // Clear all previous alerts
    }

        // Forgot password functionality
        document.getElementById('forgotPassword').addEventListener('click', function(event) {
            event.preventDefault();
            const email = document.getElementById('email').value;
            
            if (!email) {
                showAlert('Please enter your email address first', 'warning');
                return;
            }
            
            showAlert('Password reset link sent to your email', 'info');
        });

        // Function to show alerts
        function showAlert(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} alert-dismissible fade show`;
            alert.role = 'alert';
            alert.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;
            
            alertContainer.appendChild(alert);
            
            // Auto dismiss after 5 seconds
            setTimeout(() => {
                alert.classList.remove('show');
                setTimeout(() => alertContainer.removeChild(alert), 300);
            }, 5000);
        }

        // Auto-dismiss Django messages after 5 seconds
        document.addEventListener('DOMContentLoaded', function() {
            const messages = document.querySelectorAll('.alert-float');
            messages.forEach(message => {
                setTimeout(() => {
                    message.classList.remove('show');
                    setTimeout(() => message.remove(), 300);
                }, 5000);
            });
        });

    </script>
</body>
</html>